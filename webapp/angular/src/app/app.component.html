<app-toolbar/>

<main>
    <!-- <div id="background">
        <svg xmlns="http://www.w3.org/2000/svg" width="100vw" height="100vh" viewBox="0 -960 960 960" fill="#1f1f1f"><path d="M260-840q-45 0-72.5 50T160-680q0 63 17.5 111.5T210-496l110-22q13-32 26.5-73t13.5-89q0-60-27.5-110T260-840Zm55 520q19 0 32-14t13-39q0-17-8-35t-16-32l-96 20q0 40 17.5 70t57.5 30Zm385-320q-45 0-72.5 50T600-480q0 48 13.5 88.5T640-318l110 22q15-24 32.5-72T800-480q0-60-27.5-110T700-640Zm-55 520q40 0 57.5-30t17.5-70l-96-20q-8 14-16 32t-8 35q0 20 12.5 36.5T645-120ZM315-240q-77 0-117-57t-38-128l-18-27q-11-17-36.5-77T80-680q0-103 51-171.5T260-920q85 0 132.5 75.5T440-680q0 58-16 107t-28 79l8 13q8 14 22 44.5t14 63.5q0 57-35.5 95T315-240ZM645-40q-54 0-89.5-38T520-173q0-33 14-63.5t22-44.5l8-13q-12-30-28-79t-16-107q0-89 47.5-164.5T700-720q78 0 129 68.5T880-480q0 91-25.5 150.5T818-253l-18 28q1 71-38.5 128T645-40Z"/></svg>
    </div> -->

    <div id="currentPath">
        <span>{{httpDecode(currentPath)}}/</span>
        <mat-form-field>
            <mat-label>
                <ng-icon name="MatCreateNewFolderOutline" size="50px"/>
            </mat-label>
            <input matInput (change)="createSubfolder($event)" placeholder="new subfolder"/>
        </mat-form-field>
    </div>

    <div class="centered">
<!-- provide link to parent folder -->
    @if(currentPath) {
        <div class="card" (click)="chooseParentFolder()">
            <ng-icon name="MatFolderOutline" size="60px"/>
            <span class="title">..</span>
        </div>
    }

@if(folderData.entries) {
<!-- provide links to subfolders -->
    @for(entry of (folderData.entries | keyvalue); track entry) {
        @if(entry.value.isFolder) {
        <div class="card" (click)="chooseSubfolder(entry.key)">
            <ng-icon class="icon" name="MatFolderOutline"/>
            {{httpDecode(entry.key)}}
        </div>
        }
    }
<!-- provide links to files -->
    @for(entry of (folderData.entries | keyvalue); track entry) {
        @if(! entry.value.isFolder) {
            <div class="card">
                <a download href="api/catalog/{{currentPath}}/{{entry.key}}"><div>
                    <ng-icon class="icon" name="MatFileDownloadOutline"/>
                    {{entry.value.title || httpDecode(entry.key)}}
                </div></a>
                <div class="info">
                    <span>{{entry.value.timestamp! | timeago:true}}</span>
                    <span>{{entry.value.size! | filesize:{standard:'jedec'} }}</span>
                    <span>
                        <ng-icon (click)="deleteFile(entry.key)" name="MatDeleteOutline" color="red" size="6vw"/>
                    </span>
                </div>
            </div>
        }
    }
}
@else {
            <div class="card">
                <div class="title"> This folder is empty </div>
                <div> Share some files to get it started </div>
    @if(currentPath) {
                <div class="info">
                    <ng-icon (click)="removeFolder(currentPath)" name="matFolderDeleteOutline" size="30px" color="red"/>
                </div>
    }
            </div>
}
    </div>

<!-- provide add file functionality -->
<input #fileSelect type="file" (change)="addFile($event)" hidden/>
<ng-icon class="fab"
    (click)="openChooseUploadDialog(); fileSelect.click()"
    name="MatUploadFile" color="blue" size="60px"/>
</main>

