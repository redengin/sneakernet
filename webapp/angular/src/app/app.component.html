<app-toolbar/>

<main>
    <div id="currentPath">
        <span>{{currentPath}}/</span>
        <mat-form-field>
            <mat-label>
                <ng-icon name="MatCreateNewFolderOutline" size="50px"/>
            </mat-label>
            <input (change)="createSubfolder($event)" matInput/>
        </mat-form-field>
        <!-- TODO <ng-icon (click)="createNewFolder" name="MatCreateNewFolderOutline" size="30px"/> -->
    </div>

    <div class="centered">
<!-- provide link to parent folder -->
    @if(currentPath) {
        <div class="card" (click)="chooseParentFolder()">
            <ng-icon name="MatFolderOutline" size="60px"/>
            <span class="title">..</span>
        </div>
    }

@if(folderData.entries) {
<!-- provide links to subfolders -->
    @for(entry of (folderData.entries | keyvalue); track entry) {
        @if(entry.value.isFolder) {
        <div class="card" (click)="chooseSubfolder(entry.key)">
            <ng-icon name="MatFolderOutline" size="60px"/>
            <span class="title">{{entry.key}}</span>
        </div>
        }
    }
<!-- provide links to files -->
    @for(entry of (folderData.entries | keyvalue); track entry) {
        @if(! entry.value.isFolder) {
            <div class="card">
                <a download href="api/catalog/{{currentPath}}/{{entry.key}}"><div>
                    <ng-icon name="MatFileDownloadOutline" size="60px"/>
                    <span class="title"> {{entry.value.title || entry.key}} </span>
                </div></a>
                <div class="info">
                    <span>{{entry.value.timestamp! | timeago:true}}</span>
                    <span>{{entry.value.size! | filesize:{standard:'jedec'} }}</span>
                    <span>
                        <ng-icon (click)="deleteFile(entry.key)" name="MatDeleteOutline" color="red" size="30px"/>
                    </span>
                </div>
            </div>
        }
    }
}
@else {
            <div class="card">
                <div class="title"> This folder is empty </div>
                <div> Share some files to get it started </div>
    @if(currentPath) {
                <div class="info">
                    <ng-icon (click)="removeFolder(currentPath)" name="matFolderDeleteOutline" size="30px" color="red"/>
                </div>
    }
            </div>
}
    </div>

<!-- provide add file functionality -->
<input #fileSelect hidden type="file" (change)="addFile($event)"/>
<ng-icon class="fab"
    (click)="fileSelect.disabled ? uploadsDisabled() : fileSelect.click();"
    name="MatUploadFile" color="blue" size="60px"/>
</main>

